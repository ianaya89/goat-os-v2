"use client";

import { useTranslations } from "next-intl";
import { parseAsStringLiteral, useQueryState } from "nuqs";
import type * as React from "react";
import { CreditsSettingsTab } from "@/components/billing/credits-settings-tab";
import { SubscriptionSettingsTab } from "@/components/billing/subscription-settings-tab";
import { AthleteSignupLinksTab } from "@/components/organization/athlete-signup-links-tab";
import { DeleteOrganizationCard } from "@/components/organization/delete-organization-card";
import { FeaturesSettingsTab } from "@/components/organization/features-settings-tab";
import { OrganizationChangeNameCard } from "@/components/organization/organization-change-name-card";
import { OrganizationInviteMemberCard } from "@/components/organization/organization-invite-member-card";
import { OrganizationLogoCard } from "@/components/organization/organization-logo-card";
import { OrganizationMembersCard } from "@/components/organization/organization-members-card";
import {
	UnderlinedTabs,
	UnderlinedTabsContent,
	UnderlinedTabsList,
	UnderlinedTabsTrigger,
} from "@/components/ui/custom/underlined-tabs";
import { billingConfig } from "@/config/billing.config";

const tabValues = [
	"general",
	"members",
	"signupLinks",
	"features",
	"subscription",
	"credits",
] as const;
type TabValue = (typeof tabValues)[number];

type OrganizationSettingsTabsProps = {
	isAdmin: boolean;
};

export function OrganizationSettingsTabs({
	isAdmin,
}: OrganizationSettingsTabsProps): React.JSX.Element {
	const t = useTranslations("organization.settings.tabs");
	const [tab, setTab] = useQueryState(
		"tab",
		parseAsStringLiteral(tabValues).withDefault("general"),
	);

	return (
		<UnderlinedTabs
			className="w-full"
			value={tab}
			onValueChange={(value) => setTab(value as TabValue)}
		>
			<UnderlinedTabsList className="mb-6 sm:-ml-4">
				<UnderlinedTabsTrigger value="general">
					{t("general")}
				</UnderlinedTabsTrigger>
				<UnderlinedTabsTrigger value="members">
					{t("members")}
				</UnderlinedTabsTrigger>
				{isAdmin && (
					<UnderlinedTabsTrigger value="signupLinks">
						{t("signupLinks")}
					</UnderlinedTabsTrigger>
				)}
				{isAdmin && (
					<UnderlinedTabsTrigger value="features">
						{t("features")}
					</UnderlinedTabsTrigger>
				)}
				{billingConfig.enabled && (
					<UnderlinedTabsTrigger value="subscription">
						{t("subscription")}
					</UnderlinedTabsTrigger>
				)}
				{billingConfig.enabled && (
					<UnderlinedTabsTrigger value="credits">
						{t("credits")}
					</UnderlinedTabsTrigger>
				)}
			</UnderlinedTabsList>
			<UnderlinedTabsContent value="general">
				<div className="space-y-4">
					<OrganizationLogoCard />
					<OrganizationChangeNameCard />
					<DeleteOrganizationCard />
				</div>
			</UnderlinedTabsContent>
			<UnderlinedTabsContent value="members">
				<div className="space-y-4">
					{isAdmin && <OrganizationInviteMemberCard />}
					<OrganizationMembersCard />
				</div>
			</UnderlinedTabsContent>
			{isAdmin && (
				<UnderlinedTabsContent value="signupLinks">
					<AthleteSignupLinksTab />
				</UnderlinedTabsContent>
			)}
			{isAdmin && (
				<UnderlinedTabsContent value="features">
					<FeaturesSettingsTab isAdmin={isAdmin} />
				</UnderlinedTabsContent>
			)}
			{billingConfig.enabled && (
				<UnderlinedTabsContent value="subscription">
					<SubscriptionSettingsTab isAdmin={isAdmin} />
				</UnderlinedTabsContent>
			)}
			{billingConfig.enabled && (
				<UnderlinedTabsContent value="credits">
					<CreditsSettingsTab isAdmin={isAdmin} />
				</UnderlinedTabsContent>
			)}
		</UnderlinedTabs>
	);
}
